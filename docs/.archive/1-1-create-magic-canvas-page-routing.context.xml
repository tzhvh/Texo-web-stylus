<story-context id="{bmad_folder}/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1</storyId>
    <title>Create Magic Canvas Page and Routing</title>
    <status>drafted</status>
    <generatedAt>2025-11-22</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-1-create-magic-canvas-page-routing.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>to access Magic Canvas from the main navigation</iWant>
    <soThat>I can start using the new mathematical note-taking feature</soThat>
    <tasks>- [ ] Task 1: Create MagicCanvas page component (AC: 1, 2, 5)
  - [ ] Subtask 1.1: Create `src/pages/MagicCanvas.jsx` with basic page structure
  - [ ] Subtask 1.2: Add page title and metadata
  - [ ] Subtask 1.3: Implement placeholder content (will be replaced by Epic 1.2)
  - [ ] Subtask 1.4: Verify no console errors on page load

- [ ] Task 2: Add routing configuration (AC: 1)
  - [ ] Subtask 2.1: Update `src/App.jsx` to import React.lazy for MagicCanvas
  - [ ] Subtask 2.2: Add route: `<Route path="/magic-canvas" element={<MagicCanvas />} />`
  - [ ] Subtask 2.3: Wrap route in Suspense with loading fallback

- [ ] Task 3: Integrate navigation menu (AC: 1, 3)
  - [ ] Subtask 3.1: Study existing navigation structure in App.jsx
  - [ ] Subtask 3.2: Add "Magic Canvas" menu item following existing pattern
  - [ ] Subtask 3.3: Implement active state highlighting for Magic Canvas route
  - [ ] Subtask 3.4: Test navigation highlighting works correctly

- [ ] Task 4: Verify lazy loading and bundle impact (AC: 4)
  - [ ] Subtask 4.1: Build application and verify MagicCanvas is in separate chunk
  - [ ] Subtask 4.2: Test initial page load performance
  - [ ] Subtask 4.3: Verify existing pages still function correctly

- [ ] Task 5: Testing and validation (AC: 1-5)
  - [ ] Subtask 5.1: Test navigation from all existing pages
  - [ ] Subtask 5.2: Verify route works with direct URL access
  - [ ] Subtask 5.3: Test browser back/forward navigation
  - [ ] Subtask 5.4: Verify responsive design on mobile/desktop
  - [ ] Subtask 5.5: Check console for warnings/errors</tasks>
  </story>

  <acceptanceCriteria>1. **Given** I am on any Texo page, **When** I click "Magic Canvas" in navigation menu, **Then** I am routed to `/magic-canvas` and see the Magic Canvas page

2. **And** the page renders without errors or console warnings

3. **And** the navigation item is highlighted as active when on Magic Canvas

4. **And** the page is lazy-loaded (not in main bundle) to minimize initial load impact

5. **And** page metadata includes appropriate title ("Magic Canvas - Texo")</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/sprint-artifacts/tech-spec-epic-1.md" title="Epic Technical Specification: Canvas Foundation & Row Management" section="Overview" snippet="Epic 1 establishes the foundational canvas infrastructure and row management system for Magic Canvas, implementing the single-active-row architectural model that enables mindful mathematical note-taking. This epic creates the core drawing surface using Excalidraw, implements intelligent row boundaries with visual guidance, and builds the RowManager class that maintains row state and activation timeline." />
      <doc path="docs/architecture.md" title="Magic Canvas - Decision Architecture" section="Project Structure" snippet="New Files: 13, Modified Files: 4 (App.jsx, workspaceDB.js, CLAUDE.md, README.md), Reused Files: 15+, Code Reuse: ~82%" />
      <doc path="docs/epic_1_complete_breakdown.md" title="Epic 1: Canvas Foundation & Row Management" section="Story 1.1" snippet="Create `src/pages/MagicCanvas.jsx` as new route component, Update `src/App.jsx` to add route: `<Route path="/magic-canvas" element={<MagicCanvas />} />`, Add navigation link in app header/menu, Use React.lazy() for code splitting" />
    </docs>
    <code>
      <artifact path="src/App.jsx" kind="component" symbol="App" lines="1-109" reason="Main application router with existing navigation structure and lazy loading pattern for Magic Canvas" />
      <artifact path="src/pages/SketchPage.jsx" kind="component" symbol="SketchPage" lines="1-582" reason="Reference implementation for Excalidraw integration, React patterns, and page structure to follow" />
    </code>
    <dependencies>
      <ecosystem name="React">
        <package name="react" version="^18.3.1" />
        <package name="react-dom" version="^18.3.1" />
        <package name="react-router-dom" version="^7.1.1" />
      </ecosystem>
      <ecosystem name="Excalidraw">
        <package name="@excalidraw/excalidraw" version="^0.18.0" />
      </ecosystem>
      <ecosystem name="Build Tools">
        <package name="vite" version="^6.0.7" />
        <package name="tailwindcss" version="^3.4.17" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint name="React Functional Components" description="Follow existing patterns from SketchPage.jsx and ComposePage.jsx for consistency" />
    <constraint name="Lazy Loading" description="Use React.lazy() for code splitting: const MagicCanvas = React.lazy(() => import('./MagicCanvas.jsx'))" />
    <constraint name="Route Path" description="Route path must be /magic-canvas as specified in Epic 1.1 requirements" />
    <constraint name="Navigation Integration" description="Follow existing menu structure in App.jsx with active state highlighting using CSS classes" />
    <constraint name="Error Boundaries" description="Wrap route in ErrorBoundary component following existing pattern" />
    <constraint name="Page Metadata" description="Include appropriate title (Magic Canvas - Texo) using react-helmet-async" />
    <constraint name="Brownfield Compatibility" description="Ensure existing pages remain functional - no breaking changes to current routing" />
  </constraints>
  <interfaces>
    <interface name="React Router Route" kind="REST endpoint" signature="&lt;Route path=&quot;/magic-canvas&quot; element={&lt;MagicCanvas /&gt;} /&gt;" path="src/App.jsx" />
    <interface name="Navigation Link" kind="function signature" signature="&lt;Link to=&quot;/magic-canvas&quot; className={({ isActive }) =&gt; isActive ? &quot;text-blue-600 font-medium transition&quot; : &quot;text-gray-700 hover:text-blue-600 font-medium transition&quot;}&gt;Magic Canvas&lt;/Link&gt;" path="src/App.jsx" />
    <interface name="Lazy Loading Pattern" kind="function signature" signature="const MagicCanvas = lazy(() =&gt; import(&quot;./pages/MagicCanvas&quot;))" path="src/App.jsx" />
  </interfaces>
  <tests>
    <standards>Manual browser testing required for navigation and routing functionality. Verify no console errors or warnings on page load. Test lazy loading by checking network tab for separate chunk loading. Ensure existing pages remain functional (brownfield requirement). Test responsive design on different screen sizes.</standards>
    <locations>Manual browser testing - no automated test files for routing functionality. Verify in Chrome DevTools Network tab for lazy loading chunks.</locations>
    <ideas>
      <test idea="Navigate from all existing pages" acceptanceCriteria="1" />
      <test idea="Direct URL access to /magic-canvas" acceptanceCriteria="1" />
      <test idea="Browser back/forward navigation" acceptanceCriteria="1" />
      <test idea="Navigation active state highlighting" acceptanceCriteria="3" />
      <test idea="Lazy loading verification" acceptanceCriteria="4" />
      <test idea="Page title metadata" acceptanceCriteria="5" />
      <test idea="Console error/warning check" acceptanceCriteria="2" />
      <test idea="Responsive design mobile/desktop" acceptanceCriteria="1-5" />
    </ideas>
  </tests>
</story-context>